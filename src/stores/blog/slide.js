// src/stores/blog/slide.js
import { defineStore } from 'pinia'
import { ref } from 'vue'

export const useSlideStore = defineStore('slide', () => {
  const canvas = ref(null)
  const ctx = ref(null)
  const image = ref(null)
  const labeledAreas = ref([
    {
      path: [
        { id: 0, x: 346.3639164333561, y: 703.4637777342366 },
        { id: 0, x: 342.82236292982543, y: 703.4637777342366 },
        { id: 0, x: 325.114595412172, y: 703.4637777342366 },
        { id: 0, x: 303.86527439098785, y: 714.079428140707 },
        { id: 0, x: 286.1575068733344, y: 721.1565284116873 },
        { id: 0, x: 264.90818585215027, y: 738.8492790891379 },
        { id: 0, x: 247.2004183344968, y: 756.5420297665886 },
        { id: 0, x: 233.03420432037404, y: 774.2347804440393 },
        { id: 0, x: 218.86799030625127, y: 799.0046313924702 },
        { id: 0, x: 208.2433297956592, y: 827.3130324763913 },
        { id: 0, x: 208.2433297956592, y: 852.0828834248222 },
        { id: 0, x: 208.2433297956592, y: 887.4683847797236 },
        { id: 0, x: 211.78488329918991, y: 922.8538861346249 },
        { id: 0, x: 218.86799030625127, y: 954.700837354036 },
        { id: 0, x: 229.49265081684337, y: 983.0092384379572 },
        { id: 0, x: 247.2004183344968, y: 1011.3176395218782 },
        { id: 0, x: 264.90818585215027, y: 1036.0874904703091 },
        { id: 0, x: 286.1575068733344, y: 1053.7802411477599 },
        { id: 0, x: 318.0314884051106, y: 1071.4729918252106 },
        { id: 0, x: 360.5301304474789, y: 1082.088642231681 },
        { id: 0, x: 413.65343300043924, y: 1082.088642231681 },
        { id: 0, x: 456.1520750428075, y: 1075.0115419607007 },
        { id: 0, x: 498.6507170851758, y: 1053.7802411477599 },
        { id: 0, x: 530.524698616952, y: 1036.0874904703091 },
        { id: 0, x: 555.3155731416668, y: 1011.3176395218782 },
        { id: 0, x: 569.4817871557896, y: 983.0092384379572 },
        { id: 0, x: 583.6480011699124, y: 954.700837354036 },
        { id: 0, x: 594.2726616805044, y: 929.9309864056052 },
        { id: 0, x: 597.8142151840351, y: 905.1611354571742 },
        { id: 0, x: 597.8142151840351, y: 883.9298346442334 },
        { id: 0, x: 590.7311081769737, y: 866.2370839667827 },
        { id: 0, x: 580.1064476663817, y: 845.0057831538419 },
        { id: 0, x: 565.9402336522589, y: 827.3130324763913 },
        { id: 0, x: 548.2324661346055, y: 806.0817316634505 },
        { id: 0, x: 530.524698616952, y: 791.9275311214899 },
        { id: 0, x: 512.8169310992986, y: 774.2347804440393 },
        { id: 0, x: 495.1091635816451, y: 763.6191300375689 },
        { id: 0, x: 480.94294956752236, y: 753.0034796310985 },
        { id: 0, x: 466.7767355533996, y: 742.387829224628 },
        { id: 0, x: 456.1520750428075, y: 738.8492790891379 },
        { id: 0, x: 445.52741453221546, y: 728.2336286826675 },
        { id: 0, x: 434.90275402162337, y: 724.6950785471774 },
        { id: 0, x: 427.819647014562, y: 714.079428140707 },
        { id: 0, x: 420.7365400075006, y: 714.079428140707 },
        { id: 0, x: 413.65343300043924, y: 710.5408780052169 },
        { id: 0, x: 406.5703259933779, y: 707.0023278697267 },
        { id: 0, x: 399.48721898631646, y: 699.9252275987465 },
        { id: 0, x: 392.4041119792551, y: 696.3866774632563 },
        { id: 0, x: 385.3210049721937, y: 696.3866774632563 },
        { id: 0, x: 385.3210049721937, y: 692.8481273277662 },
        { id: 0, x: 378.23789796513233, y: 689.309577192276 },
        { id: 0, x: 374.69634446160165, y: 689.309577192276 },
        { id: 0, x: 371.154790958071, y: 689.309577192276 },
        { id: 0, x: 367.61323745454024, y: 689.309577192276 },
        { id: 0, x: 364.07168395100956, y: 689.309577192276 },
        { id: 0, x: 360.5301304474789, y: 685.7710270567859 },
        { id: 0, x: 356.9885769439482, y: 685.7710270567859 },
        { id: 0, x: 356.9885769439482, y: 685.7710270567859 },
        { id: 0, x: 353.4470234404175, y: 685.7710270567859 },
        { id: 0, x: 349.9054699368868, y: 685.7710270567859 },
        { id: 0, x: 349.9054699368868, y: 689.309577192276 },
        { id: 0, x: 346.3639164333561, y: 689.309577192276 },
        { id: 0, x: 342.82236292982543, y: 692.8481273277662 },
        { id: 0, x: 342.82236292982543, y: 692.8481273277662 },
        { id: 0, x: 342.82236292982543, y: 696.3866774632563 }
      ],
      visible: true,
      title: 'Celula',
      description:
        'Frozen Yogurt Lorem ipsum dolor sit amet, consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. lorem ipsum dolor sit amet, consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. lorem ipsum dolor sit amet, consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. lorem ipsum dolor sit amet, consectetur adipiscing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.'
    },
    {
      path: [
        { id: 1, x: 891.7631559770824, y: 384.99426554012456 },
        { id: 1, x: 881.1384954664903, y: 388.5328156756147 },
        { id: 1, x: 877.5969419629596, y: 392.07136581110484 },
        { id: 1, x: 866.9722814523675, y: 406.22556635306535 },
        { id: 1, x: 852.8060674382448, y: 423.91831703051605 },
        { id: 1, x: 849.264513934714, y: 441.6110677079667 },
        { id: 1, x: 842.1814069276527, y: 459.30381838541734 },
        { id: 1, x: 842.1814069276527, y: 484.07366933384833 },
        { id: 1, x: 842.1814069276527, y: 508.84352028227926 },
        { id: 1, x: 842.1814069276527, y: 537.1519213662003 },
        { id: 1, x: 852.8060674382448, y: 565.4603224501213 },
        { id: 1, x: 866.9722814523675, y: 586.6916232630622 },
        { id: 1, x: 881.1384954664903, y: 600.8458238050227 },
        { id: 1, x: 902.3878164876744, y: 622.0771246179635 },
        { id: 1, x: 923.6371375088586, y: 632.6927750244339 },
        { id: 1, x: 948.4280120335734, y: 643.3084254309043 },
        { id: 1, x: 969.6773330547576, y: 657.4626259728649 },
        { id: 1, x: 998.0097610830031, y: 664.5397262438452 },
        { id: 1, x: 1029.8837426147793, y: 668.0782763793353 },
        { id: 1, x: 1054.674617139494, y: 668.0782763793353 },
        { id: 1, x: 1086.5485986712704, y: 664.5397262438452 },
        { id: 1, x: 1111.3394731959852, y: 653.9240758373747 },
        { id: 1, x: 1136.1303477207, y: 639.7698752954142 },
        { id: 1, x: 1150.2965617348227, y: 625.6156747534536 },
        { id: 1, x: 1164.4627757489454, y: 604.3843739405129 },
        { id: 1, x: 1168.0043292524763, y: 583.153073127572 },
        { id: 1, x: 1171.545882756007, y: 558.3832221791411 },
        { id: 1, x: 1171.545882756007, y: 533.6133712307102 },
        { id: 1, x: 1175.0874362595375, y: 505.3049701467891 },
        { id: 1, x: 1171.545882756007, y: 484.07366933384833 },
        { id: 1, x: 1164.4627757489454, y: 459.30381838541734 },
        { id: 1, x: 1150.2965617348227, y: 438.07251757247656 },
        { id: 1, x: 1143.2134547277615, y: 416.84121675953577 },
        { id: 1, x: 1136.1303477207, y: 402.6870162175752 },
        { id: 1, x: 1121.9641337065773, y: 388.5328156756147 },
        { id: 1, x: 1111.3394731959852, y: 374.37861513365414 },
        { id: 1, x: 1097.1732591818625, y: 367.3015148626739 },
        { id: 1, x: 1083.0070451677395, y: 360.22441459169363 },
        { id: 1, x: 1068.8408311536168, y: 356.6858644562035 },
        { id: 1, x: 1054.674617139494, y: 353.14731432071335 },
        { id: 1, x: 1036.9668496218408, y: 349.6087641852232 },
        { id: 1, x: 1026.3421891112487, y: 346.07021404973307 },
        { id: 1, x: 1012.1759750971258, y: 346.07021404973307 },
        { id: 1, x: 998.0097610830031, y: 346.07021404973307 },
        { id: 1, x: 990.9266540759417, y: 346.07021404973307 },
        { id: 1, x: 980.3019935653497, y: 346.07021404973307 },
        { id: 1, x: 969.6773330547576, y: 346.07021404973307 },
        { id: 1, x: 962.5942260476962, y: 346.07021404973307 },
        { id: 1, x: 951.9695655371041, y: 346.07021404973307 },
        { id: 1, x: 937.8033515229813, y: 349.6087641852232 },
        { id: 1, x: 930.72024451592, y: 349.6087641852232 },
        { id: 1, x: 923.6371375088586, y: 353.14731432071335 },
        { id: 1, x: 916.5540305017972, y: 356.6858644562035 },
        { id: 1, x: 916.5540305017972, y: 360.22441459169363 },
        { id: 1, x: 913.0124769982665, y: 360.22441459169363 },
        { id: 1, x: 909.4709234947359, y: 360.22441459169363 },
        { id: 1, x: 909.4709234947359, y: 360.22441459169363 },
        { id: 1, x: 909.4709234947359, y: 360.22441459169363 }
      ],
      label: '',
      visible: true,
      title: 'Celula 2',
      description:
        'Que tal estudar com um quiz interativo ou talvez com um mapa menta. Clique no botão e aproveite nossos materias adicionais'
    }
  ])

  const redrawCanvas = () => {
    console.log('redrawCanvas')
    if (!ctx.value || !canvas.value) return
    console.log('redrawCanvas 2')
    ctx.value.clearRect(0, 0, canvas.value.width, canvas.value.height)
    ctx.value.drawImage(image.value, 0, 0)

    // Desenhar áreas baseadas no estado atual
    labeledAreas.value.forEach((area) => {
      if (area.visible) {
        ctx.value.strokeStyle = 'white'
        ctx.value.lineWidth = 16
        ctx.value.beginPath()
        area.path.forEach((point, index) => {
          if (index === 0) {
            ctx.value.moveTo(point.x, point.y)
          } else {
            ctx.value.lineTo(point.x, point.y)
          }
        })
        ctx.value.stroke()
        ctx.value.closePath()

        // Exibir rótulo
        if (area.title) {
          ctx.value.fillStyle = 'white'
          ctx.value.font = 'bold 100px Arial'
          const midpoint = area.path[Math.floor(area.path.length / 2)]
          ctx.value.fillText(area.title, midpoint.x, midpoint.y - 10)
        }
      }
    })
  }

  const loadCanvas = () => {
    // Carregue a imagem e configure o canvas aqui
    image.value = new Image()
    image.value.src =
      'https://th.bing.com/th/id/R.70f72e90f21fa0b9a884ba9b2a9e72c7?rik=5gT0EQaWi7iYew&riu=http%3a%2f%2fcv.udl.cat%2fcursos%2f100302%2fhistologia%2fbasicos%2f3.1.jpg&ehk=3Z8Bs%2f8b7ok3P2ODm7080hnW8Q5LgxSaPrVvQACAiKE%3d&risl=&pid=ImgRaw&r=0' // Substitua pela URL da sua imagem
    image.value.onload = () => {
      if (canvas.value) {
        canvas.value.width = image.value.width
        canvas.value.height = image.value.height
        redrawCanvas()
      }
    }
    redrawCanvas()
  }

  const visibleLabel = (index) => {
    labeledAreas.value.forEach((area, i) => {
      if (i == index) {
        area.visible = !area.visible
      }
    })
    redrawCanvas()
  }

  return {
    canvas,
    ctx,
    image,
    labeledAreas,
    redrawCanvas,
    loadCanvas,
    visibleLabel
  }
})
